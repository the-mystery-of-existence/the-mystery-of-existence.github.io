<!DOCTYPE html>
<html>
<head>
	<title>os 1:process schedule</title>
	<meta charset="utf-8">
	<script type="text/javascript" src="jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="jquery.dataTables.css">
	<script type="text/javascript" src="jquery.dataTables.js"></script>
	<!-- https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css
	https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js -->
	<style type="text/css">
		td {
			text-align: center;
		}

	</style>
</head>
<body>
	<script type="text/javascript">
		$(document).ready( function () {
	    $('#table_input,#table_output').DataTable();
	    $('.dataTables_empty').hide();
	} );
	</script>
	<div class='inputjobnum'>
		<input type="text" id="num" placeholder="input job num" />
		<button onClick="getJobNum()">submit</button>	
	</div>
	<br><br>
	<div class="input_table">
	<table id="table_input">
	    <thead>
	        <tr>
				<th>作业号</th>
	            <th>提交时间</th>
	            <th>运行所需时间</th>
	        </tr>
	    </thead>
	    <tbody>
	        
	    </tbody>
	</table>
	<p style="text-align:center;"><button onClick="getJobInfo()">submit</button></p>
</div>
<br><br>
<div class="output_table">
	<table id="table_output">
	    <thead>
	        <tr>
	            <th>调度次序</th>
	            <th>作业号</th>
	            <th>调度时间</th>
	            <th>周转时间</th>
	            <th>带权周转时间</th>
	        </tr>
	    </thead>
	    <tbody>
	        
	    </tbody>
	</table>
</div>
<br><br>
<div class="outputtime">
	
</div>
<script type="text/javascript">
	var jobEndTime;
	//var notComeJobArr;
	var order=0;
	var notCompleteJobArr;
	var waitJobArr;
	//var submitTimeArr;
	var resRatioArr;
	var jobnum;
	var jobNumberCount=0;
	var sumRoundTime=0;
	var sumWeightRoundTime=0;
	function getJobNum(){
	jobnum=document.getElementById('num').value;
	//alert(jobnum);
	for(var i=0;i<jobnum;i++){
	var tr='<tr><td>'+i+'</td><td><input type="text" id='+i+'0 placeholder="input submit time eg:10:20=>1020"></td><td><input type="text" id='+i+'1 placeholder="input required time eg:30min=>30"></td></tr>';
	
	$('#table_input tbody').append(tr);
	}
}
	function getJobInfo(){
		init();
		var job={};
		do{
			if(waitJobArr.length==0){
				job=selectFirstComeShortJob();
			}else{
				job=selectLargestResRatioJob();
			}
			outputAndDeleteJobAndResetArray(job);

		}while(notCompleteJobArr.length!=0);
		$('.outputtime').append('<p style="text-align:center;">平均周转时间:'+(sumRoundTime/jobnum)+'</p><p style="text-align:center;">平均带权周转时间:'+(sumWeightRoundTime/jobnum)+'</p>');
	}
	function init(){
		notCompleteJobArr=new Array();
		//notComeJobArr=new notComeJobArr();
		waitJobArr=new Array();
		for(var i=0;i<jobnum;i++){
			var job={};
			job.submitTime=parseInt(document.getElementById(i+'0').value.substring(0,2))*60+parseInt(document.getElementById(i+'0').value.substring(2));
			job.requiredTime=parseInt(document.getElementById(i+'1').value);
			job.jobNumber=jobNumberCount++;
			notCompleteJobArr.push(job);
			//notComeJobArr.push(job);
		}
	}
	function selectFirstComeShortJob(){
		//submitTimeArr=new Array();
		var index=0;
		var temp=notCompleteJobArr[0].submitTime;
		for(var i=1;i<notCompleteJobArr.length;i++){
		//submitTimeArr[i]=notCompleteJobArr[i].submitTime;
		if(notCompleteJobArr[i].submitTime<temp){
			index=i;
			temp=notCompleteJobArr[i].submitTime;
		}else if(notCompleteJobArr[i].submitTime==temp){
			index=(notCompleteJobArr[i].requiredTime<notCompleteJobArr[index].requiredTime?i:index);
		}
	}
		//var index=submitTimeArr.indexOf(Math.min.apply(Math,submitTimeArr));
		notCompleteJobArr[index].waittime=0;
		return notCompleteJobArr[index];

	}
	function selectLargestResRatioJob(){
		resRatioArr=new Array();
		for(var i=0;i<waitJobArr.length;i++){
			waitJobArr[i].resRatio=((jobEndTime-waitJobArr[i].submitTime)/waitJobArr[i].requiredTime)+1;
			resRatioArr.push(waitJobArr[i].resRatio);
		}
		var index=resRatioArr.indexOf(Math.max.apply(Math,resRatioArr));
		waitJobArr[index].waittime=jobEndTime-waitJobArr[index].submitTime;
		return waitJobArr[index];
	}
	function outputAndDeleteJobAndResetArray(job){
		//output
		var tr='<tr><td>'+(order++)+'</td><td>'+job.jobNumber+'</td><td>'+job.waittime+'</td><td>'+(job.waittime+job.requiredTime)+'</td><td>'+((job.waittime+job.requiredTime)/job.requiredTime)+'</td></tr>';
		$('#table_output tbody').append(tr);
		//Delete
		notCompleteJobArr.splice(notCompleteJobArr.indexOf(job),1);
		//resetArr
		jobEndTime=job.submitTime+job.waittime+job.requiredTime;
		sumRoundTime=sumRoundTime+job.waittime+job.requiredTime;
		sumWeightRoundTime=sumWeightRoundTime+((job.waittime+job.requiredTime)/job.requiredTime);
		waitJobArr=new Array();
		for(var i=0;i<notCompleteJobArr.length;i++){
			if(notCompleteJobArr[i].submitTime<jobEndTime){
				waitJobArr.push(notCompleteJobArr[i]);
			}
		}
	}
	
	
</script>
</body>
</html>
